!function(e){function t(e,t){return t?(Object.keys(t.query).map(function(n){e=e.replace(new RegExp("^\\?"+n+"$"),t.query[n])}),Object.keys(t.param).map(function(n){e=e.replace(new RegExp("^\\$"+n+"$"),t.param[n])}),e):e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){return regeneratorRuntime.mark(function n(){var r,i,o,a=void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=new s,i=t(a.path||"",a.query||{},a.param||{}),o=i.next().value,o.listeners=[{key:e,callback:function(e){var t=i.next(e).value;t&&(r.resolve(t),r=new s)}}],n.next=6,o;case 6:return n.next=9,r.promise;case 9:n.next=6;break;case 11:case"end":return n.stop()}},n,this)})}function i(e,t){function n(e){o&&(e.listeners=i,o=!1),r.resolve(e),r=new s}var r,i=[],o=!0;return Object.keys(t).map(function(e){i.push({key:e,callback:t[e].bind(this,n)})}),regeneratorRuntime.mark(function a(){var t=void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:r=new s,setTimeout(function(){e(n,t.path||"",t.query||{},t.param||{}),o&&n({})},0);case 2:return i.next=4,r.promise;case 4:i.next=2;break;case 5:case"end":return i.stop()}},a,this)})}var o=e&&e.riot?e.riot:require("riot");o.tag("route",' <section if="{ show }"><yield ></yield></section>',function(e){function t(e,t){if(e=e.replace(/^\//,""),"*"==e)return{};var n=[],r=e.replace(/(^|\/):([^\/]+)/g,function(e,t,r){return n.push(r),t+"([^/]+)"}),i=t.match(new RegExp("^"+r+"$"));if(!i)return null;var o={};return n.map(function(e,t){o[e]=i[t+1]}),o}var n=this;n.show=!1,n.on("update",function(){var r,i=n.parent.path,o=n.parent.query;n.show=!n.parent.found&&null!==(r=t(e.path,i)),r=r||{},n.show&&(e.redirect?/^http/.test(e.redirect)?location.href=e.redirect:location.hash=e.redirect:(n.trigger("urlchanged",{path:i,query:o,param:r}),n.parent.found=!0))})}),o.tag("router"," <yield ></yield>",function(t){var n=this,r=e,i="hashchange";n.path="",n.query={},n.found=!1,this.emit=function(e){var t=location.href.split("#")[1]||"",r=t.split("?")[0].replace(/^\/|\/$/g,""),i={};t.replace(/[?&](.+?)=([^&]*)/g,function(e,t,n){i[t]=n}),n.path=r,n.query=i,n.found=!1,e&&n.update()}.bind(this),n.on("mount",function(){r.addEventListener?r.addEventListener(i,n.emit,!1):r.attachEvent("on"+i,n.emit)}),n.on("unmount",function(){r.removeEventListener?r.removeEventListener(i,n.emit,!1):r.detachEvent("on"+i,n.emit)}),n.emit()}),o.mixin("ikki",{$$version:0,init:function(){var e=this,n=e.$$findAncestor("route");n?n.on("urlchanged",function(n){e.$$loadOpts(e.opts.opts,n),e.one("update",function(){Object.keys(e.opts).map(function(r){"string"==typeof e.opts[r]&&(e.opts[r]=t(e.opts[r],n))})})}):e.$$loadOpts(e.opts.opts)},$$findAncestor:function(e){for(tag=this;tag&&e!=tag.root.tagName.toLowerCase();)tag=tag.parent;return tag||null},$$loadOpts:function(e,t){function n(e){function t(t){i<r.$$version||(r.$$extendOpts(t)&&r.update(),setTimeout(function(){n(e)},0))}var o=e.next().value;o&&(o.then?o.then(t):t(o))}if(e){var r=this,i=++r.$$version;"object"!=typeof e||e.then?"object"==typeof e?e.then(function(e){r.$$extendOpts(e)&&r.update()}):e&&"GeneratorFunction"==e.constructor.name?n(t?e(t):e()):"function"==typeof e&&r.$$extendOpts(e(t)):r.$$extendOpts(e)}},$$extendOpts:function(e){var t=this;e.listeners&&(e.listeners.map(function(e){t.on(e.key,e.callback)}),delete e.listeners);var n=Object.keys(e);return n.map(function(n){t.opts[n]=e[n]}),n.length>0}}),o.mixin("parentScope",{init:function(){this._ownPropKeys=[],this._ownOptsKeys=[];for(var e in this)this._ownPropKeys[e]=!0;for(var e in this.opts)this._ownOptsKeys[e]=!0;this.on("update",function(){for(var e in this.parent)this._ownPropKeys[e]||(this[e]=this.parent[e]);for(var e in this.parent.opts)this._ownOptsKeys[e]||(this.opts[e]=this.parent.opts[e])})},updateCaller:function(e){var t=[];for(var n in this.parent._ownPropKeys||this.parent)t.push(n);for(var r=0;r<t.length;r++)if(this.parent[t[r]]===e)return void this.parent.update();this.parent.updateCaller&&this.parent.updateCaller(e)}});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=this;n(this,e),this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n})}return a(e,[{key:"resolve",value:function(e){this._resolve(e)}},{key:"reject",value:function(e){this._reject(e)}}]),e}(),u=function(){function e(){n(this,e)}return a(e,[{key:"direction",value:function(e,t,n){}},{key:"push",value:function(e){this.deferred.resolve(e),this.deferred=new s}},{key:"error",value:function(e){this.deferred.reject(e),this.deferred=new s}},{key:"start",value:function(){var e=this;return regeneratorRuntime.mark(function t(){var n=void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.deferred=new s,setTimeout(function(){e.direction(n.path||"",n.query||{},n.param||{})},10);case 2:return t.next=5,e.deferred.promise;case 5:t.next=2;break;case 7:case"end":return t.stop()}},t,this)})}},{key:"stop",value:function(){var e=void 0===arguments[0]?{}:arguments[0];this.push(e)}},{key:"on",value:function(e,t){var n=this;setTimeout(function(){n.push({listeners:[{key:e,callback:t}]})},1e3)}}]),e}();"object"==typeof exports&&(module.exports={Deferred:s,edo:r,kyoto:i,Nara:u})}("undefined"!=typeof window?window:void 0);